<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kuaiyou.lucky.mapper.AdviserMapper">

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, name, advid, status, ctime, price, desc, utime, jumptype, starttime, endtime, type, appkey, appsecret, iconurl, inserturl, bannerurl, qrurl
    </sql>
    
    <select id="activityList" resultType="com.kuaiyou.lucky.res.AdviserRes">
    	SELECT t.*,ac.name AS proname
		FROM t_luck_adviser t
		LEFT JOIN t_luck_activity ac ON t.advid = ac.id
		<where>
			<if test="starttime != null and starttime != ''">
				AND t.ctime &gt;= #{starttime}
			</if>
			<if test="endtime != null and endtime != ''">
				AND t.ctime &lt;= #{endtime}
			</if>
			<if test="name != null and name != ''">
				AND t.name LIKE CONCAT('%',#{name},'%')
			</if>
		</where>
		<choose>
			<when test="sorts != null and sorts.length >0">
				ORDER BY (
					<foreach collection="sorts" item="sort" separator=",">
						${sort}	
					</foreach>
				) 
			</when>
            <otherwise>
				ORDER BY t.ctime
            </otherwise>
        </choose>
        <choose>
			<when test="order == 1">
				ASC
			</when>
            <otherwise>
            	DESC
            </otherwise>
        </choose>
		<if test="page !=null  and skip > 0">
			LIMIT #{page},#{skip}
		</if>;
    </select>
    <select id="activityListCount" resultType="java.lang.Integer">
    	SELECT COUNT(1)
		FROM t_luck_adviser t
		<where>
			<if test="starttime != null and starttime != ''">
				AND t.ctime &gt;= #{starttime}
			</if>
			<if test="endtime != null and endtime != ''">
				AND t.ctime &lt;= #{endtime}
			</if>
			<if test="name != null and name != ''">
				AND t.name LIKE CONCAT('%',#{name},'%')
			</if>
		</where>
    </select>

</mapper>
